â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User visits: /city/Makati%20City?country=Philippines       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CityContent Component Renders                               â”‚
â”‚  1. getCityDataCached() â†’ CACHED (1 hour)                   â”‚
â”‚  2. DynamicCityStats (Suspense) â†’ FRESH (no cache)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Two Fetch Calls to SAME API Route                          â”‚
â”‚                                                              â”‚
â”‚  Call 1 (Cached):                                           â”‚
â”‚  GET /api/web/cities/Makati%20City?country=Philippines      â”‚
â”‚  Cache: revalidate: 3600                                    â”‚
â”‚                                                              â”‚
â”‚  Call 2 (Fresh):                                            â”‚
â”‚  GET /api/web/cities/Makati%20City?country=Philippines      â”‚
â”‚  Cache: no-store                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Your API Route Handler                                      â”‚
â”‚  /app/api/web/cities/[id]/route.ts                          â”‚
â”‚                                                              â”‚
â”‚  Processes BOTH requests identically:                        â”‚
â”‚  1. Extracts id: "Makati City"                              â”‚
â”‚  2. Extracts country: "Philippines"                          â”‚
â”‚  3. Queries database                                         â”‚
â”‚  4. Returns full CityData JSON                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response Handling                                           â”‚
â”‚                                                              â”‚
â”‚  Call 1 â†’ getCityDataCached() returns full CityData         â”‚
â”‚           Used for hero, description, images, etc.          â”‚
â”‚                                                              â”‚
â”‚  Call 2 â†’ getCityStatsOnly() extracts ONLY stats fields    â”‚
â”‚           Used for CityStats component                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


# First request (CACHED - for hero section)
ğŸ“¦ Fetching CACHED city data
ğŸ” Looking for city: Makati City, country: Philippines
âœ… City data found: Makati City (AI Generated: true)
â†’ Result cached for 1 hour

# Second request (FRESH - for stats component)
âš¡ Fetching FRESH stats data
ğŸ” Looking for city: Makati City, country: Philippines  
âœ… City data found: Makati City (AI Generated: true)
â†’ Result NOT cached, always fresh

// Page load sequence:

// 1. Hero section renders (uses cached data)
const cityData = await getCityDataCached("Makati City", "Philippines");
// â†’ Hits API, caches for 1 hour
// â†’ Returns: { id, name, description, imageUrl, totalCourts, ... }

// 2. Stats section renders inside Suspense (uses fresh data)
const stats = await getCityStatsOnly("Makati City", "Philippines");
// â†’ Hits API again, NO cache
// â†’ Returns: { totalCourts, totalClubs, totalPlayers, ... }

app/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ web/
â”‚       â””â”€â”€ cities/
â”‚           â””â”€â”€ [id]/
â”‚               â”œâ”€â”€ route.ts          // Full data (cached)
â”‚               â””â”€â”€ stats/
â”‚                   â””â”€â”€ route.ts      // Stats only (fresh)



â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Next.js Frontend (Vercel)        â”‚
â”‚   - Supabase Auth only              â”‚
â”‚   - No database connection          â”‚
â”‚   - API calls to external backend   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ HTTP/REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   External Backend API              â”‚
â”‚   (e.g., separate Next.js/Express)  â”‚
â”‚   - Prisma + PostgreSQL             â”‚
â”‚   - Stripe API keys                 â”‚
â”‚   - All business logic              â”‚
â”‚   - Database operations             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
